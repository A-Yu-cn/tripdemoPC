<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>去哪儿网-我的收藏</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" href="css/index.css">
    <style>
        .tab-content .row>div {
            margin-top: 16px;
        }

        .tab-content {
            margin-bottom: 36px;
        }
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="js/common.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script>
        $("#header").load("header.html");
        $("#footer").load("footer.html");
    </script>
</head>

<body>
    <div id="header"></div>
    <div id="app">
        <!-- 排行榜 start-->
        <section id="content">
            <section class="hemai_jx">
                <div class="jx_top">
                    <div class="jx_tit">
                        <img src="images/icon_5.jpg" alt="">
                        <span>我的订单</span>
                    </div>
                </div>
                <div class="jx_content">
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="home">
                            <div class="row">
                                <div class="col-md-3" v-for="(item,index) in img_urls">
                                    <button @click="gotoOrderDetail(index)">
                                        <img :src="item['imageUrl']" alt="" style="height: 180px;">
                                        <div class="has_border">
                                            <h3>{{item['name']}}</h3>
                                            <div class="price">
                                                网付价<em>￥</em><strong>{{item['originalCost']}}</strong><em>起</em></div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </section>
        <!-- 排行榜 end-->
    </div>
    <!--引入尾部-->
    <div id="footer">
        <!-- 尾部 start-->
    </div>
</body>
<script>
    let vm = new Vue({
        el: "#app",
        data: {
            list_orders: [],
            img_urls: []
        },
        created: function () {
            let self = this;
            if (!localStorage.getItem("username")) {
                alert("请登录后再来查看您的订单");
                window.location.href = "login.html";
            } else {
                axios.get(window.domain + "/indents", { headers: { "token": window.localStorage.getItem("token") } })
                    .then(function (response) {
                        //console.log(response);
                        self.list_orders = response.data.data;
                        // console.log(self.list_orders);
                        for (let i = 0; i < self.list_orders.length; i++) {
                            axios.get(window.domain + "/items", { params: { "name": self.list_orders[i].itemInfo } })
                                .then(function (response) {
                                    //console.log(response.data.data[0]);
                                    self.img_urls.push(response.data.data[0]);
                                })
                                .catch(function (error) {
                                    console.log(error);
                                })
                        }
                        console.log(self.img_urls);//测试完成，项目名称与图片一一对应
                    })
                    .catch(function (error) {
                        console.log(error);
                    })
            }
        },
        methods: {
            gotoOrderDetail: function (index) {
                let self = this;
                window.localStorage.setItem("order_info", JSON.stringify(self.img_urls[index]));//设置订单详情
                window.localStorage.setItem("indentNo", self.list_orders[index]["indentNo"]);
                // console.log(window.localStorage.getItem("indentNo"));
                window.location.href = "order_detail.html";
            }
        }
    })
</script>

</html>